# モグラたたきリミックス – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「モグラたたきリミックス」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、スコアロジック、タイマー機能などの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `title` | ゲームタイトル表示 |
| `score` | スコア表示エリア |
| `timer` | 残り時間表示 |
| `start-button` | 「スタート」ボタン |
| `retry-button` | リトライボタン |
| `hole-0` to `hole-8` | 穴（0-8の番号） |
| `character-0` to `character-8` | キャラクター（0-8の番号） |
| `game-over-screen` | ゲーム終了画面 |
| `final-score` | 最終スコア表示 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `score`, `timer`, `start-button` が存在することを確認
3. 9個の穴（`hole-0` to `hole-8`）が存在することを確認
4. スコアが「0点」、タイマーが「30」で表示されることを確認
5. `start-button` が有効であることを確認

---

### TC02: スタートボタンでゲーム開始

**目的**: スタートボタンでゲームが正しく開始されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. タイマーがカウントダウンを開始することを確認
4. `start-button` が無効になることを確認
5. キャラクターが穴から出現し始めることを確認

---

### TC03: 敵キャラクター（モグラ）のタップ成功

**目的**: 敵キャラクターを正しくタップできることを確認

**手順**
1. ゲームを開始
2. 敵キャラクター（茶色）が出現するまで待機
3. 敵キャラクターをクリック
4. スコアが+10点されることを確認
5. キャラクターが消えることを確認

---

### TC04: 味方キャラクター（ウサギ）のタップ失敗

**目的**: 味方キャラクターをタップした時の減点を確認

**手順**
1. ゲームを開始
2. 味方キャラクター（白色）が出現するまで待機
3. 味方キャラクターをクリック
4. スコアが-20点されることを確認
5. キャラクターが消えることを確認

---

### TC05: 味方キャラクターの見逃し成功

**目的**: 味方キャラクターを見逃した時のボーナス点を確認

**手順**
1. ゲームを開始
2. 味方キャラクター（白色）が出現するまで待機
3. キャラクターが自然に消えるまで何もしない
4. スコアが+5点されることを確認

---

### TC06: タイマーのカウントダウン確認

**目的**: 30秒タイマーが正しく動作することを確認

**手順**
1. ゲームを開始
2. タイマー表示が30から29、28...とカウントダウンすることを確認
3. 0になった時にゲームが終了することを確認
4. `game-over-screen` が表示されることを確認

---

### TC07: ゲーム終了時の結果表示

**目的**: ゲーム終了時に正しく結果が表示されることを確認

**手順**
1. ゲームを30秒間プレイ
2. タイマーが0になってゲーム終了
3. `game-over-screen` が表示されることを確認
4. `final-score` に最終スコアが表示されることを確認
5. `retry-button` が表示されることを確認

---

### TC08: リトライボタンでゲームが再開

**目的**: リトライによって状態が初期化されることを確認

**手順**
1. ゲームを完了し、結果画面を表示
2. `retry-button` をクリック
3. スコアが0にリセットされることを確認
4. タイマーが30にリセットされることを確認
5. `game-over-screen` が非表示になることを確認
6. `start-button` が再び有効になることを確認

---

### TC09: 複数キャラクターの同時出現

**目的**: 複数の穴からキャラクターが同時に出現した時の動作確認

**手順**
1. ゲームを開始
2. 複数のキャラクターが同時に出現するまで待機
3. それぞれのキャラクターを個別にクリック
4. 各クリックに対してスコアが正しく更新されることを確認

---

### TC10: モバイル対応確認（ビューポート）

**目的**: モバイル画面サイズでレイアウトが破綻していないことを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が表示され、画面内に収まっていることを確認
4. タップ操作が正しく動作することを確認

---

### TC11: 連続タップの処理

**目的**: 同じ穴への連続タップが正しく処理されることを確認

**手順**
1. ゲームを開始
2. キャラクターが出現した穴を複数回連続でクリック
3. スコアが1回分のみ更新されることを確認
4. キャラクターが1回目のクリックで消えることを確認

---

### TC12: 空の穴のタップ

**目的**: キャラクターがいない穴をタップした時の動作確認

**手順**
1. ゲームを開始
2. キャラクターが出現していない穴をクリック
3. スコアが変化しないことを確認
4. 特に異常な動作が発生しないことを確認

---

### TC13: ゲーム中のスコア計算精度

**目的**: 複数のアクションでスコアが正確に計算されることを確認

**手順**
1. ゲームを開始
2. 以下のアクションを順番に実行:
   - 敵キャラクターを2回タップ (+20点)
   - 味方キャラクターを1回タップ (-20点)
   - 味方キャラクターを1回見逃し (+5点)
3. 最終スコアが5点になることを確認

---

### TC14: タイマー残り5秒での緊急表示

**目的**: 残り時間が少ない時の視覚的フィードバック確認

**手順**
1. ゲームを開始し、25秒経過するまで待機
2. タイマー表示が5秒以下で色が変わるなどの変化があることを確認
3. 最後の5秒間も正常にカウントダウンが続くことを確認

---

## 🔧 テストのための補足実装（推奨）

- キャラクターの種類（敵/味方）をdata属性で識別可能にすること
- テスト中のみキャラクター出現タイミングを制御するオプション（例: ?test=true）を用意すると、精度の高い検証が可能
- スコア変化の詳細をログ出力できる機能があると、デバッグが容易

---

## 📄 備考

- テストはPlaywrightの `page.waitForFunction` や `expect.poll` を活用して、キャラクターの出現を監視しながら操作を行うことを推奨
- タイマーやアニメーションを含むため、適切な待機時間とタイムアウト設定に注意
- 実際のゲームプレイでは予測が困難な出現パターンのため、複数回テストを実行して安定性を確認することが重要