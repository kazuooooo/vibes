# くしゃみバトル – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「くしゃみバトル」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、チャージシステム、ゲーム進行ロジックなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `title` | ゲームタイトル表示 |
| `charge-gauge` | チャージゲージ |
| `charge-button` | くしゃみチャージボタン |
| `power-display` | 威力表示エリア |
| `distance-display` | 距離表示エリア |
| `player-character` | プレイヤーキャラクター |
| `enemy-character` | 敵キャラクター |
| `retry-button` | リトライボタン |
| `result-message` | 結果メッセージ |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `charge-button`, `charge-gauge`, `player-character`, `enemy-character` が存在することを確認
3. `charge-button` が有効であることを確認
4. `distance-display` に初期距離が表示されることを確認

---

### TC02: チャージゲージの動作確認

**目的**: ボタン長押し時にチャージゲージが正しく動作するか確認

**手順**
1. `/` にアクセス
2. `charge-button` をマウスダウン（押し始め）
3. 500ms 待機
4. `charge-gauge` の値が0より大きくなっていることを確認
5. マウスアップ（ボタンリリース）
6. チャージが停止することを確認

---

### TC03: 短時間チャージ（弱威力）

**目的**: 0.5秒未満のチャージで弱威力になることを確認

**手順**
1. `/` にアクセス
2. `charge-button` を200ms長押し
3. `power-display` が「威力: 1」と表示されることを確認
4. 敵キャラがわずかに移動することを確認

---

### TC04: 中程度チャージ（普通威力）

**目的**: 1秒程度のチャージで普通威力になることを確認

**手順**
1. `/` にアクセス
2. `charge-button` を1000ms長押し
3. `power-display` が「威力: 2-4」の範囲内であることを確認
4. 敵キャラが適度に移動することを確認

---

### TC05: 長時間チャージ（強威力）

**目的**: 2秒程度のチャージで強威力になることを確認

**手順**
1. `/` にアクセス
2. `charge-button` を2000ms長押し
3. `power-display` が「威力: 5-7」の範囲内であることを確認
4. 敵キャラが大きく移動することを確認

---

### TC06: 最強チャージ

**目的**: 2.5-3.0秒のチャージで最強威力になることを確認

**手順**
1. `/` にアクセス
2. `charge-button` を2750ms長押し
3. `power-display` が「威力: 8-10」の範囲内であることを確認
4. 敵キャラが大幅に移動することを確認

---

### TC07: チャージ暴発

**目的**: 3.0秒以上のチャージで暴発（威力激減）することを確認

**手順**
1. `/` にアクセス
2. `charge-button` を3500ms長押し
3. `power-display` が「威力: 1」と表示されることを確認
4. `result-message` に「暴発」のメッセージが表示されることを確認
5. 敵キャラがわずかしか移動しないことを確認

---

### TC08: 勝利条件の確認

**目的**: 敵キャラを十分に吹き飛ばした時の勝利判定を確認

**手順**
1. `/` にアクセス
2. 複数回、最強レベルのチャージを実行
3. 敵キャラの位置を監視し、画面外（または十分遠く）に移動することを確認
4. `result-message` に勝利メッセージが表示されることを確認
5. `retry-button` が表示されることを確認

---

### TC09: リトライボタンでゲームが再開できる

**目的**: リトライによって状態が初期化されることを確認

**手順**
1. ゲームを一度プレイして結果を表示させる
2. `retry-button` をクリック
3. `power-display`、`result-message` がリセットされることを確認
4. 敵キャラが初期位置に戻ることを確認
5. `charge-gauge` が0に戻ることを確認

---

### TC10: 連続チャージ防止

**目的**: チャージ中に複数回のクリックが影響しないことを確認

**手順**
1. `/` にアクセス
2. `charge-button` を長押し開始
3. チャージ中に追加でクリック操作
4. チャージが正常に継続されることを確認
5. 威力計算が正確に行われることを確認

---

### TC11: モバイル対応確認（ビューポート）

**目的**: モバイル画面サイズでレイアウトが破綻していないことを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. 主要UI (`charge-button`, `charge-gauge`, キャラクター) が表示され、画面内に収まっていることを確認
4. タッチ操作でチャージが正常に動作することを確認

---

### TC12: キャラクターアニメーション

**目的**: くしゃみ発射時のビジュアルエフェクトが正常に動作するか確認

**手順**
1. `/` にアクセス
2. `charge-button` を適度にチャージしてリリース
3. プレイヤーキャラクターのくしゃみアニメーションが実行されることを確認
4. 敵キャラクターの吹き飛ばされるアニメーションが実行されることを確認
5. アニメーション完了後に次のチャージが可能になることを確認

---

## 🔧 テストのための補足実装（推奨）

- `charge-gauge` の数値をdata属性で取得可能にすること
- `power-display` の威力値をDOMで確認可能にすること
- 敵キャラクターの位置情報をdata属性で取得可能にすること
- テスト中のみアニメーション速度を調整するオプション（例: ?test=true）を用意すると、精度の高い検証が可能

---

## 📄 備考

- テストはPlaywrightの `page.mouse.down()` / `page.mouse.up()` を活用して長押し操作をシミュレートすることを推奨
- チャージ時間の測定には `page.waitForTimeout()` や `expect.poll()` を使用
- アニメーションを含むため、`page.waitForFunction()` でアニメーション完了を待機