# ネコの宅配便 – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「ネコの宅配便」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、キャラクターの移動、障害物との衝突判定、荷物の配達システム、スコアリングシステムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `timer-display` | タイマー表示 |
| `score-display` | スコア表示 |
| `health-display` | 体力表示 |
| `packages-display` | 配達済み荷物数表示 |
| `road-area` | 道路エリア |
| `cat-player` | 猫キャラクター |
| `obstacle` | 障害物（class属性で種類を区別） |
| `package` | 荷物オブジェクト |
| `delivery-target` | 配達先 |
| `game-status` | ゲーム状態表示 |
| `final-score` | 最終スコア表示 |
| `title` | ゲームタイトル表示 |
| `left-button` | 左移動ボタン（モバイル） |
| `right-button` | 右移動ボタン（モバイル） |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `timer-display`, `score-display`, `health-display`, `packages-display` が存在することを確認
3. `start-button` が有効であることを確認
4. 初期タイマーが「120」、初期スコアが「0」、初期体力が「3」、初期荷物数が「0」であることを確認
5. `road-area` と `cat-player` が表示されることを確認

---

### TC02: ゲーム開始でプレイ状態に移行

**目的**: スタートボタンでゲームが開始し、タイマーとゲーム要素が動作開始することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `game-status` が「playing」状態になることを確認
4. タイマーがカウントダウンを開始することを確認（120→119→118...）
5. `road-area` 内に道路の流れるアニメーションが開始されることを確認
6. `start-button` が無効化または非表示になることを確認

---

### TC03: 猫キャラクターの左右移動

**目的**: 猫キャラクターがキーボード操作で正しく左右に移動することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 左矢印キーを押して `cat-player` が左に移動することを確認
4. 右矢印キーを押して `cat-player` が右に移動することを確認
5. AキーとDキーでも同様に移動することを確認
6. 猫が画面端を超えないことを確認

---

### TC04: 障害物の出現と流れ

**目的**: ゲーム開始後に障害物が道路上を流れることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `road-area` 内に `obstacle` 要素が出現することを確認
4. 障害物が上から下に移動することを確認（transform styleの変化）
5. 複数の障害物が時間差で出現することを確認
6. 障害物に種類を表す class 属性が付与されていることを確認（car, construction, hole, tree, signal）

---

### TC05: 障害物との衝突判定

**目的**: 猫が障害物に衝突した際に正しくペナルティが発生することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 猫を障害物の位置に移動させて衝突させる
4. 体力が1減少することを確認
5. スコアが20点減少することを確認
6. 画面に衝突エフェクトが表示されることを確認

---

### TC06: 体力システムとゲームオーバー

**目的**: 体力が0になった際にゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 意図的に障害物に3回衝突して体力を0にする
4. 体力が段階的に減少することを確認（3→2→1→0）
5. 体力が0になったときに `game-status` が「finished」になることを確認
6. `final-score` に最終スコアが表示されることを確認
7. `retry-button` が表示されることを確認

---

### TC07: 荷物のピックアップ

**目的**: 荷物を正しくピックアップできることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `package` オブジェクトが道路上に出現することを確認
4. 猫を荷物の位置に移動させて接触させる
5. 荷物が消えることを確認
6. ピックアップエフェクトが表示されることを確認
7. `delivery-target` が表示されることを確認

---

### TC08: 荷物の配達システム

**目的**: 荷物を配達先に届けてスコアを獲得できることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 荷物をピックアップ
4. 猫を `delivery-target` の位置に移動させる
5. 配達が完了することを確認
6. スコアが200点増加することを確認
7. `packages-display` の配達済み数が増加することを確認
8. 配達エフェクトが表示されることを確認

---

### TC09: スコア計算システム

**目的**: 配達時のボーナス計算が正しく行われることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 荷物をピックアップし、素早く配達（30秒以内）
4. 基本点200点 + 時間ボーナス100点 = 300点になることを確認
5. 無傷で配達した場合、さらに+50点のパーフェクトボーナスが加算されることを確認
6. 距離ボーナスが適切に計算されることを確認

---

### TC10: タイマー機能とゲーム終了

**目的**: 120秒後にゲームが自動終了することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. タイマーが120から0まで正しくカウントダウンすることを確認
4. タイマーが0になったときに `game-status` が「finished」になることを確認
5. `final-score` に最終スコアが表示されることを確認
6. `retry-button` が表示されることを確認
7. 障害物と荷物の出現が停止することを確認

---

### TC11: リトライ機能

**目的**: ゲーム終了後のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、タイマーが0になるまで待つまたは体力を0にする
3. `retry-button` をクリック
4. `timer-display` が「120」にリセットされることを確認
5. `score-display` が「0」にリセットされることを確認
6. `health-display` が「3」にリセットされることを確認
7. `packages-display` が「0」にリセットされることを確認
8. ゲームが再開されることを確認

---

### TC12: モバイル操作ボタン

**目的**: モバイル用の左右移動ボタンが正しく機能することを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. `left-button` と `right-button` が表示されることを確認
4. `left-button` をタップして猫が左に移動することを確認
5. `right-button` をタップして猫が右に移動することを確認
6. ボタンが適切なサイズでタッチしやすいことを確認

---

### TC13: 障害物の種類別テスト

**目的**: 5種類すべての障害物が正しく表示・判定されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 各種類の障害物（car, construction, hole, tree, signal）が出現することを確認
4. 各種類について正しいサイズで表示されることを確認
5. 各種類について正しい衝突判定が行われることを確認

---

### TC14: 複数オブジェクトの同時処理

**目的**: 複数の障害物と荷物が同時に存在する状況での正しい処理を確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 複数の障害物と荷物が同時に `road-area` に存在することを確認
4. 荷物をピックアップしながら障害物を避ける操作を行う
5. 各オブジェクトが独立して正しく処理されることを確認

---

### TC15: 連続配達でのスコア確認

**目的**: 複数の荷物を連続配達した際のスコア累積が正しいことを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 荷物を3回連続で配達
4. 各配達でスコアが正しく累積されることを確認
5. 配達済み荷物数が正しくカウントされることを確認
6. 体力回復（荷物配達で+1）が正しく機能することを確認

---

### TC16: 高速操作防止

**目的**: 高速な連続操作が適切に処理されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 左右キーを素早く連続で押す
4. 猫の移動が適切に処理されることを確認
5. 同じ荷物への重複ピックアップが発生しないことを確認

---

### TC17: レスポンシブレイアウト確認

**目的**: 異なる画面サイズでレイアウトが正常に表示されることを確認

**手順**
1. デスクトップサイズ (1920x1080) でアクセス
2. すべてのUI要素が適切に表示されることを確認
3. タブレットサイズ (768x1024) に変更して確認
4. モバイルサイズ (375x667) に変更して確認
5. 各サイズでゲームが正常にプレイできることを確認

---

## 🔧 テストのための補足実装（推奨）

- 障害物の種類をclass属性で判定可能にすること（例: `obstacle-car`, `obstacle-construction`）
- 現在のゲーム状態をdata属性で確認可能にすること
- テスト用フラグ（例: ?test=true）で道路の移動速度を調整可能にすること  
- 荷物と配達先のID属性で個別追跡可能にすること
- 衝突判定の範囲をテスト用に可視化できる機能

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、オブジェクトの移動やタイマーのタイミングを適切に制御すること
- 障害物や荷物のアニメーション中の状態変化を正確に検証するため、適切な待機時間を設定すること
- スコア計算の検証では、各操作後に期待値と実際の値を詳細に比較すること
- タイマー機能のテストでは、実際に120秒待つのではなく、タイマーを高速化するなどの工夫を検討すること
- 衝突判定のテストでは、オブジェクトの位置関係を正確に制御するため、座標ベースの移動を活用すること