# ヅラ飛ばし – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「ヅラ飛ばし」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、ゲームロジック、キャッチ判定システムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `game-field` | ゲームフィールド |
| `player` | プレイヤーキャラクター |
| `score-display` | スコア表示 |
| `life-display` | ライフ表示 |
| `status-message` | 状態メッセージ表示 |
| `title` | ゲームタイトル表示 |
| `combo-display` | コンボ表示 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `score-display`, `life-display` が存在することを確認
3. `start-button` が有効であることを確認
4. `game-field` と `player` が存在することを確認
5. 初期スコアが「0」、初期ライフが「3」であることを確認

---

### TC02: ゲーム開始でカウントダウンが表示

**目的**: スタートボタンでゲームが開始し、カウントダウンが始まることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `status-message` に「3」「2」「1」「スタート！」が順番に表示されることを確認
4. カウントダウン後にゲームが開始されることを確認

---

### TC03: プレイヤーの左右移動（キーボード）

**目的**: キーボードでプレイヤーが左右に移動できることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. `A` キーまたは左矢印キーを押下
4. プレイヤーが左に移動することを確認
5. `D` キーまたは右矢印キーを押下
6. プレイヤーが右に移動することを確認
7. ゲームフィールドの境界で移動が制限されることを確認

---

### TC04: ヅラの落下

**目的**: ヅラが画面上部から落下することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 画面上部にヅラが出現することを確認
4. ヅラが下向きに移動することを確認
5. ヅラが画面下部に到達すると消えることを確認

---

### TC05: ヅラのキャッチ判定

**目的**: プレイヤーがヅラをキャッチできることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 落下するヅラの位置にプレイヤーを移動
4. ヅラとプレイヤーが接触
5. ヅラが消えることを確認
6. スコアが10点増加することを確認

---

### TC06: ヅラの取り逃がし

**目的**: ヅラを取り逃がした場合にライフが減ることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 意図的にヅラを取り逃がす
4. ライフが1減少することを確認
5. `life-display` が更新されることを確認

---

### TC07: ゲームオーバー

**目的**: ライフが0になった場合にゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 意図的に3回ヅラを取り逃がす
4. ライフが0になることを確認
5. `status-message` が「ゲームオーバー」になることを確認
6. `retry-button` が表示されることを確認
7. 最終スコアが表示されることを確認

---

### TC08: コンボシステム

**目的**: 連続でヅラをキャッチした場合にコンボボーナスが発生することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 連続で3個のヅラをキャッチ
4. `combo-display` に「COMBO x3!」が表示されることを確認
5. スコアにコンボボーナス（15点）が加算されることを確認

---

### TC09: 難易度の上昇

**目的**: 時間経過で難易度が上昇することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 30秒間プレイを継続
4. ヅラの落下速度が初期より速くなることを確認
5. ヅラの出現頻度が高くなることを確認

---

### TC10: スペシャルヅラ

**目的**: 金色のスペシャルヅラが出現し、高得点を獲得できることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 60秒以上プレイを継続
4. 金色のヅラが出現することを確認
5. 金色のヅラをキャッチして50点獲得することを確認

---

### TC11: リトライ機能

**目的**: ゲームオーバー時のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、ゲームオーバーにする
3. `retry-button` をクリック
4. スコアが「0」にリセットされることを確認
5. ライフが「3」にリセットされることを確認
6. ゲームが再開されることを確認

---

### TC12: モバイル対応（タッチ操作）

**目的**: モバイル画面でタッチ操作が正常に動作することを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. ゲームを開始
4. 画面左側をタッチしてプレイヤーが左に移動することを確認
5. 画面右側をタッチしてプレイヤーが右に移動することを確認
6. ゲームが正常にプレイできることを確認

---

### TC13: レスポンシブデザイン

**目的**: 異なる画面サイズでレイアウトが正常に表示されることを確認

**手順**
1. デスクトップサイズ (1920x1080) でアクセス
2. すべてのUI要素が適切に表示されることを確認
3. タブレットサイズ (768x1024) でアクセス
4. レイアウトが適切に調整されることを確認
5. モバイルサイズ (375x667) でアクセス
6. UI要素が画面内に収まることを確認

---

### TC14: キーボード操作の重複防止

**目的**: 複数のキーが同時に押された場合の動作を確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. 左右のキーを同時に押下
4. プレイヤーの移動が適切に制御されることを確認
5. 意図しない動作をしないことを確認

---

### TC15: ゲーム中の状態管理

**目的**: ゲーム中の各種状態が正しく管理されることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始
3. スコア、ライフ、コンボ数が正しく更新されることを確認
4. ゲーム時間が正しく計測されることを確認
5. 各種状態がリアルタイムで反映されることを確認

---

## 🔧 テストのための補足実装（推奨）

- ヅラの位置情報をdata属性で確認可能にすること
- プレイヤーの位置情報をdata属性で確認可能にすること
- テスト用のフラグ（例: ?test=true）でゲーム速度を調整可能にすること
- 現在のゲーム状態をDOMで確認可能にすること
- 衝突判定の結果をテスト可能にすること

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、アニメーションのタイミングを適切に制御すること
- ゲーム中の動的な要素（ヅラの落下、プレイヤーの移動）を正確に検証するため、適切な待機時間を設定すること
- 連続したキャッチ判定のテストでは、タイミングを慎重に制御すること
- モバイル対応のテストでは、タッチイベントの座標を正確に指定すること