# つまみ食いチャレンジ – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「つまみ食いチャレンジ – 親にバレないように食べる」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、親キャラクターの振り向きロジック、タイミング判定システムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `parent-character` | 親キャラクター |
| `snack-area` | お菓子エリア |
| `current-snack` | 現在のお菓子アイテム |
| `level-display` | レベル表示 |
| `score-display` | スコア表示 |
| `timer-display` | タイマー表示 |
| `status-message` | 状態メッセージ表示 |
| `title` | ゲームタイトル表示 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `level-display`, `score-display`, `timer-display` が存在することを確認
3. `start-button` が有効であることを確認
4. `parent-character` が後ろ向き状態で表示されることを確認
5. `snack-area` が存在することを確認
6. 初期レベルが「1」、初期スコアが「0」、初期タイマーが「30」であることを確認

---

### TC02: ゲーム開始で親と菓子が初期化される

**目的**: スタートボタンでゲームが開始し、親キャラクターとお菓子が適切に配置されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `parent-character` が後ろ向き状態であることを確認
4. `current-snack` が表示されることを確認
5. `timer-display` がカウントダウンを開始することを確認
6. `status-message` が「チャンス！」になることを確認

---

### TC03: 安全な時間にお菓子を食べる（成功パターン）

**目的**: 親が後ろ向きの時にお菓子をクリックしてスコアが上がることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `parent-character` が後ろ向き状態であることを確認
4. `status-message` が「チャンス！」であることを確認
5. `current-snack` をクリック
6. スコアが10点増加することを確認
7. 新しいお菓子が表示されることを確認

---

### TC04: 親が振り向いている時にクリック（失敗パターン）

**目的**: 親が振り向いている時にお菓子をクリックしてゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 親が振り向くまで待機
4. `parent-character` の向きが変わったことを確認
5. `status-message` が「危険！」または空白になることを確認
6. この状態で `current-snack` をクリック
7. `status-message` が「バレた！」になることを確認
8. `retry-button` が表示されることを確認

---

### TC05: 親の振り向きパターンの確認

**目的**: 親が定期的に振り向くパターンが実装されていることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. レベル1で親の振り向きが約3秒間隔で発生することを確認
4. 振り向く前に「危険！」の警告が1秒前に表示されることを確認
5. 振り向いている間（2-3秒）はお菓子がクリック不可になることを確認
6. 後ろ向きに戻ると再び「チャンス！」が表示されることを確認

---

### TC06: タイマーによる時間制限

**目的**: 制限時間が正しく機能し、時間切れでレベルクリアになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. タイマーが30秒からカウントダウンすることを確認
4. 途中でお菓子を何個か食べる
5. タイマーが0になるまで待機
6. レベルクリア状態になることを確認
7. 次のレベルに進むまたはスコア集計が表示されることを確認

---

### TC07: 連続成功ボーナス

**目的**: 連続でお菓子を食べた時にボーナススコアが加算されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 安全な時間に1個目のお菓子をクリック（10点）
4. 続けて2個目のお菓子をクリック（10 + 5点ボーナス = 15点）
5. 続けて3個目のお菓子をクリック（10 + 10点ボーナス = 20点）
6. スコアが累積で45点になることを確認

---

### TC08: レベル2への進行

**目的**: レベル1クリア後にレベル2に進み、難易度が上がることを確認

**手順**
1. `/` にアクセス
2. レベル1をクリア（時間切れまでプレイ）
3. `level-display` が「2」になることを確認
4. `timer-display` が35秒に設定されることを確認
5. 親の振り向き間隔がランダム（2-4秒）になることを確認
6. スコア倍率が1.2倍になることを確認

---

### TC09: ゲームオーバー時のリトライ機能

**目的**: ゲームオーバー時のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、意図的に親にバレてゲームオーバーにする
3. `retry-button` をクリック
4. `level-display` が「1」にリセットされることを確認
5. `score-display` が「0」にリセットされることを確認
6. `timer-display` が「30」にリセットされることを確認
7. 新しいゲームが開始されることを確認

---

### TC10: スコア計算の正確性

**目的**: 各種スコア計算が正確に行われることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. お菓子を1個食べて10点獲得することを確認
4. 連続で2個目を食べて15点（10+5ボーナス）追加されることを確認
5. レベル1を完了してレベルクリアボーナス100点が追加されることを確認
6. 合計スコアが正しく計算されることを確認

---

### TC11: 危険警告の表示タイミング

**目的**: 親が振り向く1秒前に「危険！」警告が表示されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ゲーム開始から約2秒後に `status-message` が「危険！」になることを確認
4. その1秒後に親キャラクターが実際に振り向くことを確認
5. 振り向き中はお菓子がクリック不可になることを確認

---

### TC12: モバイル対応確認

**目的**: モバイル画面サイズでレイアウトが正常に表示されることを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が画面内に収まって表示されることを確認
4. お菓子エリアが適切なサイズでタッチしやすいことを確認
5. 親キャラクターが適切に表示されることを確認
6. ゲームが正常にプレイできることを確認

---

### TC13: 高レベルでの動作確認

**目的**: レベル3以上でも正常に動作することを確認

**手順**
1. `/` にアクセス
2. レベル3まで進む（テストモードまたは自動化で実現）
3. タイマーが40秒に設定されることを確認
4. 親の振り向き間隔が1-3秒の不規則になることを確認
5. スコア倍率が1.5倍になることを確認
6. 正常にゲームが進行することを確認

---

### TC14: お菓子の種類とランダム表示

**目的**: 異なる種類のお菓子がランダムに表示されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 複数回お菓子を食べて、異なる種類のお菓子が表示されることを確認
4. お菓子の画像やアイコンが適切に表示されることを確認
5. どのお菓子をクリックしても同じ得点が得られることを確認

---

### TC15: 同時クリック防止

**目的**: お菓子の連続クリックが適切に処理されることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、安全な時間にお菓子を表示
3. 同じお菓子を素早く複数回クリック
4. 1回の食事として正しく処理されることを確認
5. スコアが重複加算されないことを確認

---

## 🔧 テストのための補足実装（推奨）

- `parent-character` の向き状態をdata属性で確認可能にすること
- テスト用のフラグ（例: ?test=true）で親の振り向きタイミングを調整可能にすること
- 現在のゲーム状態をDOMで確認可能にすること
- タイマーの残り時間を正確に取得可能にすること

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、親の振り向きタイミングを適切に制御すること
- タイマーやアニメーションの状態変化を正確に検証するため、適切な待機時間を設定すること
- レベル進行のテストでは、各フェーズ間の状態遷移を慎重に検証すること
- モバイル環境でのタッチイベントが正常に動作することを確認すること