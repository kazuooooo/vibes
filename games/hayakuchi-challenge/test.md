# 早口言葉チャレンジ – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「早口言葉チャレンジ」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、音声認識機能、早口言葉表示ロジック、判定システムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- Web Speech APIのモック機能を使用してテストを実行
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `tongue-twister-display` | 早口言葉表示エリア |
| `mic-button` | マイクボタン |
| `time-display` | 制限時間表示 |
| `level-display` | レベル表示 |
| `score-display` | スコア表示 |
| `status-message` | 状態メッセージ表示 |
| `title` | ゲームタイトル表示 |
| `recognition-result` | 音声認識結果表示 |
| `fallback-input` | テキスト入力代替手段 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `level-display`, `score-display` が存在することを確認
3. `start-button` が有効であることを確認
4. `mic-button` が存在することを確認
5. 初期レベルが「1」、初期スコアが「0」であることを確認
6. 初期状態メッセージが「準備完了」であることを確認

---

### TC02: ゲーム開始で早口言葉表示フェーズに移行

**目的**: スタートボタンでゲームが開始し、早口言葉が表示されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `status-message` が「挑戦してください」になることを確認
4. `tongue-twister-display` エリアに早口言葉「生麦生米生卵」が表示されることを確認
5. `time-display` に制限時間「5」が表示されることを確認
6. `mic-button` が有効化されることを確認

---

### TC03: 制限時間のカウントダウン

**目的**: 制限時間が正しくカウントダウンされることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `time-display` の値が定期的に減少することを確認
4. 残り3秒でカウントダウン表示が変化することを確認
5. 時間切れで自動的にゲームオーバーになることを確認

---

### TC04: マイクボタンでの音声認識開始

**目的**: マイクボタンクリックで音声認識が機能することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `mic-button` をクリック
4. `status-message` が「認識中...」になることを確認
5. `mic-button` にアニメーション効果が表示されることを確認
6. 音声認識APIが呼び出されることを確認（モック）

---

### TC05: 正しい発音での判定（レベル1クリア）

**目的**: 正しい発音をした場合にレベルクリアできることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `mic-button` をクリック
4. 音声認識結果として「生麦生米生卵」をモック
5. `status-message` が「正解！」になることを確認
6. `level-display` が「2」になることを確認
7. `score-display` が「100」以上になることを確認（時間ボーナス含む）

---

### TC06: 間違った発音での判定（ゲームオーバー）

**目的**: 間違った発音をした場合にゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `mic-button` をクリック
4. 音声認識結果として「なまむぎなまこめ」をモック（間違った発音）
5. `status-message` が「ゲームオーバー」になることを確認
6. `retry-button` が表示されることを確認
7. `mic-button` が無効化されることを確認

---

### TC07: 時間切れでのゲームオーバー

**目的**: 制限時間内に発音できなかった場合の処理を確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 制限時間が経過するまで待機（音声認識を実行しない）
4. `status-message` が「ゲームオーバー」になることを確認
5. `retry-button` が表示されることを確認

---

### TC08: レベル2での早口言葉変更

**目的**: レベル2で異なる早口言葉が表示されることを確認

**手順**
1. `/` にアクセス
2. レベル1をクリアしてレベル2に進む
3. `level-display` が「2」であることを確認
4. `tongue-twister-display` に「隣の客はよく柿食う客だ」が表示されることを確認
5. `time-display` に制限時間「6」が表示されることを確認

---

### TC09: スコア計算の確認

**目的**: レベルクリア時のスコア計算が正しく行われることを確認

**手順**
1. `/` にアクセス
2. レベル1をクリア（基本100点 + 時間ボーナス）
3. レベル2をクリア（基本200点 + 時間ボーナス）
4. 合計スコアが正しく計算されることを確認
5. 完璧クリア時の+50点ボーナスが適用されることを確認

---

### TC10: リトライ機能

**目的**: ゲームオーバー時のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、意図的にゲームオーバーにする
3. `retry-button` をクリック
4. `level-display` が「1」にリセットされることを確認
5. `score-display` が「0」にリセットされることを確認
6. 最初の早口言葉が再表示されることを確認

---

### TC11: 音声認識が使用できない場合の代替手段

**目的**: Web Speech APIが使用できない環境での代替手段を確認

**手順**
1. Web Speech APIを無効化した状態でアクセス
2. `fallback-input` テキスト入力フォームが表示されることを確認
3. 手動で「生麦生米生卵」を入力
4. Enter または送信ボタンで判定されることを確認
5. 正解判定が正常に機能することを確認

---

### TC12: マイク権限拒否時の処理

**目的**: マイク権限が拒否された場合の適切な処理を確認

**手順**
1. マイク権限を拒否した状態でアクセス
2. `mic-button` をクリック
3. 権限エラーメッセージが表示されることを確認
4. `fallback-input` が自動的に表示されることを確認
5. テキスト入力での代替プレイが可能であることを確認

---

### TC13: 高レベルでの動作確認

**目的**: レベル5以上でも正常に動作することを確認

**手順**
1. `/` にアクセス
2. レベル5まで進む（テストモードまたは自動化で実現）
3. 「坊主が屏風に上手に坊主の絵を描いた」が表示されることを確認
4. 制限時間が8秒に設定されることを確認
5. スコア計算が正しく行われることを確認（500点 + ボーナス）

---

### TC14: 連続音声認識の防止

**目的**: 音声認識中に重複してマイクボタンが押されることを防ぐ

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `mic-button` をクリック
4. 認識中に再度 `mic-button` をクリック
5. 2回目のクリックが無視されることを確認
6. 認識処理が適切に継続されることを確認

---

### TC15: モバイル対応確認

**目的**: モバイル画面サイズでレイアウトが正常に表示されることを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が画面内に収まって表示されることを確認
4. `mic-button` が適切なサイズでタッチしやすいことを確認
5. ゲームが正常にプレイできることを確認

---

### TC16: 認識結果表示の確認

**目的**: 音声認識結果がユーザーに適切に表示されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `mic-button` をクリック
4. 音声認識結果として「なまむぎなまこめなまたまご」をモック
5. `recognition-result` に認識結果が表示されることを確認
6. 正解との比較結果が視覚的に分かりやすく表示されることを確認

---

### TC17: 音声波形エフェクトの表示

**目的**: 音声認識中の視覚的フィードバックが正常に動作することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `mic-button` をクリック
4. 音声認識中に波形アニメーションが表示されることを確認
5. 認識終了時にエフェクトが停止することを確認

---

## 🔧 テストのための補足実装（推奨）

- Web Speech APIのモック機能の実装
- `recognition-result` の結果をdata属性で確認可能にすること
- テスト用のフラグ（例: ?test=true）で制限時間を調整可能にすること
- 現在の認識状況をDOMで確認可能にすること
- マイク権限の状態をテスト可能にすること

---

## 📄 備考

- テストはPlaywrightの `page.evaluate` を活用してWeb Speech APIをモックすること
- 音声認識処理中の状態変化を正確に検証するため、適切な待機時間を設定すること
- モバイルでのマイク操作テストでは、実際のデバイスまたはエミュレーターでの検証も推奨
- 異なるブラウザでの音声認識API対応状況を考慮したテストを実装すること