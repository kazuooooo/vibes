# 回転寿司キャッチャー – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「回転寿司キャッチャー」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、寿司の流れ、キャッチ判定、スコアリングシステムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `timer-display` | タイマー表示 |
| `score-display` | スコア表示 |
| `combo-display` | コンボ数表示 |
| `order-display` | 注文表示エリア |
| `lane-area` | 寿司が流れるレーンエリア |
| `sushi-plate` | 寿司皿（class属性で種類を区別） |
| `game-status` | ゲーム状態表示 |
| `final-score` | 最終スコア表示 |
| `title` | ゲームタイトル表示 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `timer-display`, `score-display`, `combo-display` が存在することを確認
3. `start-button` が有効であることを確認
4. 初期タイマーが「60」、初期スコアが「0」、初期コンボが「0」であることを確認
5. `order-display` と `lane-area` が表示されることを確認

---

### TC02: ゲーム開始でプレイ状態に移行

**目的**: スタートボタンでゲームが開始し、タイマーとゲーム要素が動作開始することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `game-status` が「playing」状態になることを確認
4. タイマーがカウントダウンを開始することを確認（60→59→58...）
5. `order-display` に注文が表示されることを確認
6. `start-button` が無効化または非表示になることを確認

---

### TC03: 寿司皿が流れる

**目的**: ゲーム開始後に寿司皿がレーン上を流れることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `lane-area` 内に `sushi-plate` 要素が出現することを確認
4. 寿司皿が右から左に移動することを確認（transform styleの変化）
5. 複数の寿司皿が時間差で出現することを確認
6. 寿司皿に種類を表す class 属性が付与されていることを確認

---

### TC04: 正しい寿司のキャッチ

**目的**: 注文通りの寿司をクリックした際に正しくキャッチできることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `order-display` で現在の注文を確認（例：「まぐろ」）
4. 対応する種類の `sushi-plate` が流れてくるまで待機
5. 該当の寿司皿をクリック
6. スコアが100点増加することを確認
7. 新しい注文が `order-display` に表示されることを確認
8. キャッチした寿司皿が消えることを確認

---

### TC05: 間違った寿司のキャッチ（ペナルティ）

**目的**: 注文と違う寿司をクリックした際にペナルティが発生することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `order-display` で現在の注文を確認（例：「まぐろ」）
4. 注文と異なる種類の `sushi-plate` をクリック
5. スコアが50点減少することを確認
6. コンボが0にリセットされることを確認
7. 注文は変わらないことを確認

---

### TC06: 寿司の見逃し（ペナルティ）

**目的**: 正しい寿司を見逃した際にペナルティが発生することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `order-display` で現在の注文を確認
4. 対応する寿司皿が流れてきてもクリックせず見逃す
5. 寿司皿が画面左端で消えることを確認
6. スコアが30点減少することを確認
7. コンボが0にリセットされることを確認

---

### TC07: コンボシステムの確認

**目的**: 連続成功時のコンボボーナスが正しく計算されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 正しい寿司を連続で3回キャッチ
4. 1回目: スコア +100, コンボ 1
5. 2回目: スコア +120 (100+20), コンボ 2  
6. 3回目: スコア +140 (100+40), コンボ 3
7. `combo-display` が正しく更新されることを確認

---

### TC08: タイマー機能とゲーム終了

**目的**: 60秒後にゲームが自動終了することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. タイマーが60から0まで正しくカウントダウンすることを確認
4. タイマーが0になったときに `game-status` が「finished」になることを確認
5. `final-score` に最終スコアが表示されることを確認
6. `retry-button` が表示されることを確認
7. 寿司皿の流れが停止することを確認

---

### TC09: リトライ機能

**目的**: ゲーム終了後のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、タイマーが0になるまで待つ
3. `retry-button` をクリック
4. `timer-display` が「60」にリセットされることを確認
5. `score-display` が「0」にリセットされることを確認
6. `combo-display` が「0」にリセットされることを確認
7. 新しい注文が表示されることを確認
8. ゲームが再開されることを確認

---

### TC10: スコア計算の精度確認

**目的**: 複雑なスコア計算（コンボ+ペナルティ）が正しく行われることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 以下の順序で操作を行い、スコアを確認:
   - 正解 → スコア: 100, コンボ: 1
   - 正解 → スコア: 220, コンボ: 2
   - 間違い → スコア: 170, コンボ: 0
   - 正解 → スコア: 270, コンボ: 1
4. 各ステップでスコアとコンボが期待値通りになることを確認

---

### TC11: 複数の寿司同時流れ

**目的**: 複数の寿司が同時に流れている状況での正しい判定を確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 複数の寿司皿が同時に `lane-area` に存在することを確認
4. 注文に合った寿司のみをクリック
5. 正しい寿司のみがキャッチされることを確認
6. 他の寿司は引き続き流れることを確認

---

### TC12: 寿司の種類判定

**目的**: 6種類すべての寿司が正しく表示・判定されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 各種類の寿司（まぐろ、サーモン、えび、たまご、いくら、うに）が注文として出現することを確認
4. 各種類の寿司皿が流れてくることを確認
5. 各種類について正しいキャッチ判定が行われることを確認

---

### TC13: モバイル対応確認

**目的**: モバイル画面サイズでレイアウトが正常に表示され、タッチ操作が機能することを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が画面内に収まって表示されることを確認
4. 寿司皿が適切なサイズでタッチしやすいことを確認
5. タッチ操作でキャッチができることを確認
6. ゲームが正常にプレイできることを確認

---

### TC14: 高速クリック防止

**目的**: 同じ寿司皿への連続クリックが適切に処理されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 1つの寿司皿に対して素早く複数回クリック
4. 1回のキャッチとして処理されることを確認
5. スコアが重複して加算されないことを確認

---

### TC15: 注文システムの動作確認

**目的**: 注文の生成と更新が正しく行われることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 初期注文がランダムに表示されることを確認
4. 正解した後、新しい注文に更新されることを確認
5. 不正解時は注文が維持されることを確認
6. 注文と実際に流れる寿司に対応関係があることを確認（注文された寿司が出現頻度高い）

---

## 🔧 テストのための補足実装（推奨）

- 寿司皿の種類をclass属性で判定可能にすること（例: `sushi-maguro`, `sushi-salmon`）
- 現在のゲーム状態をdata属性で確認可能にすること
- テスト用フラグ（例: ?test=true）で寿司の移動速度を調整可能にすること  
- 寿司皿のID属性で個別の皿を追跡可能にすること

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、寿司の移動やタイマーのタイミングを適切に制御すること
- 寿司のアニメーション中の状態変化を正確に検証するため、適切な待機時間を設定すること
- スコア計算の検証では、各操作後に期待値と実際の値を詳細に比較すること
- タイマー機能のテストでは、実際に60秒待つのではなく、タイマーを高速化するなどの工夫を検討すること