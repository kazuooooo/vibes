# ハムスタートンネル – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「ハムスタートンネル」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、トンネル掘りロジック、ハムスター移動システムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `game-field` | ゲームフィールド |
| `grid-cell` | グリッドセル（個別） |
| `hamster` | ハムスターキャラクター |
| `start-point` | スタート地点 |
| `goal-point` | ゴール地点 |
| `level-display` | レベル表示 |
| `score-display` | スコア表示 |
| `timer-display` | タイマー表示 |
| `status-message` | 状態メッセージ表示 |
| `title` | ゲームタイトル表示 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `level-display`, `score-display`, `timer-display` が存在することを確認
3. `start-button` が有効であることを確認
4. `game-field` が5×5のグリッドで表示されることを確認
5. 初期レベルが「1」、初期スコアが「0」、初期タイマーが「30」であることを確認
6. `hamster` がスタート地点（左上）に表示されることを確認
7. `start-point`（左上）と `goal-point`（右下）が正しく表示されることを確認

---

### TC02: ゲーム開始でトンネル掘りフェーズに移行

**目的**: スタートボタンでゲームが開始し、トンネル掘りフェーズになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `status-message` が「トンネルを掘ってください」になることを確認
4. `game-field` のグリッドセルがクリック可能になることを確認
5. タイマーがカウントダウンを開始することを確認
6. `start-button` が非表示または無効化されることを確認

---

### TC03: トンネル掘り機能

**目的**: マウスクリックでトンネルが掘れることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 土ブロック（掘れるマス）をクリック
4. クリックしたマスがトンネル（空白）になることを確認
5. 複数のマスをクリックして連続でトンネルが掘れることを確認
6. 既に掘られたマスをクリックしても変化しないことを確認
7. スタート地点とゴール地点はクリックできないことを確認

---

### TC04: ハムスター移動フェーズへの移行

**目的**: トンネルを掘った後、ハムスターが移動を開始することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. スタートからゴールまでの経路になるようにトンネルを掘る
4. 移動開始ボタン（再度 `start-button` またはステートの変化）を確認
5. `status-message` が「ハムスター移動中」になることを確認
6. グリッドセルがクリック不可になることを確認
7. ハムスターが実際に移動開始することを確認

---

### TC05: ハムスターの正常移動（レベル1クリア）

**目的**: ハムスターが正しい経路でゴールまで移動してレベルクリアできることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. スタート地点からゴール地点まで確実に繋がる経路を作成
4. ハムスターの移動を開始
5. ハムスターが掘った経路に沿って移動することを確認
6. ハムスターがゴール地点に到達することを確認
7. `status-message` が「クリア！」になることを確認
8. `level-display` が「2」になることを確認
9. `score-display` が「100」以上になることを確認（時間ボーナス込み）

---

### TC06: 経路なしでゲームオーバー

**目的**: ゴールまでの経路がない場合にゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ゴールまで到達できない経路（途中で途切れる）を作成
4. ハムスターの移動を開始
5. ハムスターが移動を試みるが途中で止まることを確認
6. `status-message` が「ゲームオーバー」になることを確認
7. `retry-button` が表示されることを確認

---

### TC07: 制限時間切れでゲームオーバー

**目的**: 制限時間内にクリアできない場合にゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. トンネルを掘らずに時間経過を待つ
4. `timer-display` が「0」になることを確認
5. `status-message` が「ゲームオーバー」になることを確認
6. `retry-button` が表示されることを確認

---

### TC08: レベル2での難易度上昇

**目的**: レベル2でフィールドサイズが6×6になることを確認

**手順**
1. `/` にアクセス
2. レベル1をクリアしてレベル2に進む
3. `level-display` が「2」であることを確認
4. `game-field` が6×6のグリッドになることを確認
5. `timer-display` が「35」から開始することを確認
6. ハムスターとゴールの位置が適切に調整されることを確認

---

### TC09: スコア計算の確認

**目的**: レベルクリア時のスコア計算が正しく行われることを確認

**手順**
1. `/` にアクセス
2. レベル1をクリア（基本スコア100点 + 時間ボーナス）
3. レベル2をクリア（基本スコア200点 + 時間ボーナス）
4. `score-display` が正しく累計されることを確認
5. 時間ボーナスが適切に計算されることを確認

---

### TC10: リトライ機能

**目的**: ゲームオーバー時のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、意図的にゲームオーバーにする
3. `retry-button` をクリック
4. `level-display` が「1」にリセットされることを確認
5. `score-display` が「0」にリセットされることを確認
6. `timer-display` が「30」にリセットされることを確認
7. フィールドが初期状態（5×5）に戻ることを確認
8. トンネル掘りフェーズが再開されることを確認

---

### TC11: 最短経路ボーナス

**目的**: 最短経路でクリアした場合のボーナス計算を確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. スタートからゴールまでの理論的最短経路のみを掘る
4. レベルクリア
5. スコアに最短経路ボーナス（+500点）が加算されることを確認

---

### TC12: モバイル対応確認

**目的**: モバイル画面サイズでレイアウトが正常に表示されることを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が画面内に収まって表示されることを確認
4. グリッドセルが適切なサイズでタップしやすいことを確認
5. ゲームが正常にプレイできることを確認

---

### TC13: 複数クリック防止

**目的**: ハムスター移動中にグリッドセルがクリックできないことを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、経路を作ってハムスターを移動開始
3. ハムスター移動中にグリッドセルをクリック
4. クリックが無効化されていることを確認
5. ゲーム状態に影響しないことを確認

---

### TC14: ハムスターアニメーション確認

**目的**: ハムスターの移動アニメーションが滑らかに表示されることを確認

**手順**
1. `/` にアクセス
2. 複数マスにわたる経路を作成
3. ハムスターの移動を開始
4. ハムスターが各マスを滑らかに移動することを確認
5. 移動速度が適切（約500ms/マス）であることを確認

---

### TC15: エッジケースの処理

**目的**: 特殊な状況での動作を確認

**手順**
1. `/` にアクセス
2. 以下のエッジケースを検証：
   - スタート地点を囲むようにトンネルを掘る
   - ゴール地点を完全に囲む（到達不可にする）
   - フィールド全体をトンネルにする
   - トンネルを一切掘らない
3. 各ケースで適切にゲームオーバーまたはクリアが判定されることを確認

---

## 🔧 テストのための補足実装（推奨）

- グリッドセルに座標情報をdata属性で設定（`data-x`, `data-y`）
- ハムスターの移動経路をテストで確認可能にする仕組み
- テスト用のフラグ（例: ?test=true）でハムスターの移動速度を調整可能にすること
- フィールドの状態（どのマスが掘られているか）をDOMで確認可能にすること

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、ハムスターの移動タイミングを適切に制御すること
- ハムスター移動中の状態変化を正確に検証するため、適切な待機時間を設定すること
- 連続したレベルクリアのテストでは、各フェーズ間の状態遷移を慎重に検証すること
- アニメーション効果があるため、要素の状態確認前に十分な待機時間を設けること