# 方向記憶 – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「方向記憶」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、矢印表示ロジック、記憶・判定システムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `arrow-display` | 矢印表示エリア |
| `direction-up` | 上方向ボタン |
| `direction-down` | 下方向ボタン |
| `direction-left` | 左方向ボタン |
| `direction-right` | 右方向ボタン |
| `level-display` | レベル表示 |
| `score-display` | スコア表示 |
| `status-message` | 状態メッセージ表示 |
| `title` | ゲームタイトル表示 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `level-display`, `score-display` が存在することを確認
3. `start-button` が有効であることを確認
4. 方向ボタンが4つ（up, down, left, right）存在することを確認
5. 初期レベルが「1」、初期スコアが「0」であることを確認

---

### TC02: ゲーム開始で矢印表示フェーズに移行

**目的**: スタートボタンでゲームが開始し、矢印表示が始まることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `status-message` が「観察してください」になることを確認
4. `arrow-display` エリアに矢印が表示されることを確認
5. 方向ボタンが無効化されることを確認

---

### TC03: 矢印が順番に表示される

**目的**: レベル1で3つの矢印が順番に表示されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `arrow-display` の内容を記録しながら、3つの矢印が順番に表示されることを確認
4. 各矢印の表示時間が適切（約800ms）であることを確認
5. 矢印間に適切な間隔（約200ms）があることを確認

---

### TC04: 入力フェーズへの移行

**目的**: 矢印表示完了後に入力フェーズに移行することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 矢印表示が完了するまで待機
4. `status-message` が「入力してください」になることを確認
5. 方向ボタンがすべて有効化されることを確認

---

### TC05: 正しい順番での入力（レベル1クリア）

**目的**: 正しい順番で入力した場合にレベルクリアできることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 表示された矢印の順番を記録
4. 入力フェーズで記録した順番通りに方向ボタンをクリック
5. `status-message` が「正解！」になることを確認
6. `level-display` が「2」になることを確認
7. `score-display` が「100」になることを確認

---

### TC06: 間違った順番での入力（ゲームオーバー）

**目的**: 間違った順番で入力した場合にゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 表示された矢印の順番を記録
4. 入力フェーズで意図的に間違った順番で方向ボタンをクリック
5. `status-message` が「ゲームオーバー」になることを確認
6. `retry-button` が表示されることを確認
7. 方向ボタンが無効化されることを確認

---

### TC07: レベル2での矢印数増加

**目的**: レベル2で矢印が4つ表示されることを確認

**手順**
1. `/` にアクセス
2. レベル1をクリアしてレベル2に進む
3. `level-display` が「2」であることを確認
4. 矢印表示フェーズで4つの矢印が表示されることを確認
5. 正しい順番で入力してクリアできることを確認

---

### TC08: スコア計算の確認

**目的**: レベルクリア時のスコア計算が正しく行われることを確認

**手順**
1. `/` にアクセス
2. レベル1をクリア（スコア100点）
3. レベル2をクリア（スコア200点追加で合計300点）
4. `score-display` が「300」になることを確認

---

### TC09: リトライ機能

**目的**: ゲームオーバー時のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、意図的にゲームオーバーにする
3. `retry-button` をクリック
4. `level-display` が「1」にリセットされることを確認
5. `score-display` が「0」にリセットされることを確認
6. 矢印表示フェーズが再開されることを確認

---

### TC10: 連続入力の防止

**目的**: 矢印表示中に方向ボタンが無効化されていることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 矢印表示中に方向ボタンをクリック
4. ボタンが反応せず、ゲーム状態に影響しないことを確認

---

### TC11: モバイル対応確認

**目的**: モバイル画面サイズでレイアウトが正常に表示されることを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が画面内に収まって表示されることを確認
4. 方向ボタンが適切なサイズでタッチしやすいことを確認
5. ゲームが正常にプレイできることを確認

---

### TC12: 高レベルでの動作確認

**目的**: レベル5以上でも正常に動作することを確認

**手順**
1. `/` にアクセス
2. レベル5まで進む（テストモードまたは自動化で実現）
3. 7つ以上の矢印が表示されることを確認
4. スコア計算が正しく行われることを確認（レベル5で500点）
5. 正常に入力・判定が行われることを確認

---

### TC13: 複数クリック防止

**目的**: 入力フェーズで同じボタンの連続クリックが適切に処理されることを確認

**手順**
1. `/` にアクセス
2. ゲームを開始し、入力フェーズに移行
3. 同じ方向ボタンを素早く複数回クリック
4. 1回の入力として正しく処理されることを確認

---

## 🔧 テストのための補足実装（推奨）

- `arrow-display` の矢印情報をdata属性で確認可能にすること
- テスト用のフラグ（例: ?test=true）で矢印の表示速度を調整可能にすること
- 現在の入力状況をDOMで確認可能にすること（何番目の入力かなど）

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、矢印表示のタイミングを適切に制御すること
- 矢印表示中の状態変化を正確に検証するため、適切な待機時間を設定すること
- 連続したレベルクリアのテストでは、各フェーズ間の状態遷移を慎重に検証すること