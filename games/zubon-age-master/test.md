# ズボン上げマスター – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「ズボン上げマスター – 落ちるズボンを防ぐ」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、ズボン落下ロジック、スコア・ライフシステムなどの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `character-area` | キャラクター表示エリア |
| `zubon` | ズボン要素 |
| `score-display` | スコア表示 |
| `life-display` | ライフ表示 |
| `status-message` | 状態メッセージ表示 |
| `title` | ゲームタイトル表示 |
| `combo-display` | コンボ数表示 |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `score-display`, `life-display` が存在することを確認
3. `start-button` が有効であることを確認
4. `character-area` と `zubon` が存在することを確認
5. 初期スコアが「0」、初期ライフが「3」であることを確認
6. `status-message` が「準備中」であることを確認

---

### TC02: ゲーム開始でゲーム中状態に移行

**目的**: スタートボタンでゲームが開始し、ズボン落下イベントが始まることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `status-message` が「ゲーム中」になることを確認
4. `start-button` が非表示または無効化されることを確認
5. `zubon` の位置が初期状態にあることを確認

---

### TC03: ズボン落下イベントの発生

**目的**: ゲーム開始後にズボンが落下し始めることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 3-5秒以内に`zubon`の位置が変化することを確認（警告フェーズ）
4. ズボンが徐々に下がることを確認（危険フェーズ）
5. クリックしない場合、ズボンが完全に落ちることを確認（落下フェーズ）

---

### TC04: ズボンを上げる成功パターン

**目的**: タイミングよくキャラクターをクリックしてズボンを上げることができることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ズボンが落ち始めたら `character-area` をクリック
4. ズボンが元の位置に戻ることを確認
5. スコアが増加することを確認（10点または20点）
6. ライフが減らないことを確認

---

### TC05: ズボン落下によるライフ減少

**目的**: ズボンが完全に落ちた場合にライフが減ることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ズボンが落ち始めても何もクリックしない
4. ズボンが完全に落ちるまで待つ
5. `life-display` が「2」に減ることを確認
6. 新しいズボン落下イベントが始まることを確認

---

### TC06: パーフェクトタイミング判定

**目的**: 危険フェーズの後半でクリックした場合にパーフェクトスコア（20点）が獲得できることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ズボンが危険フェーズ（かなり下がった状態）になるまで待つ
4. 危険フェーズの後半で `character-area` をクリック
5. スコアが20点増加することを確認
6. 特別エフェクトが表示されることを確認（あれば）

---

### TC07: 早すぎるクリック判定

**目的**: 警告フェーズでクリックした場合に低スコア（5点）になることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ズボンが少し下がり始めた直後（警告フェーズ）で `character-area` をクリック
4. スコアが5点増加することを確認
5. ズボンが元の位置に戻ることを確認

---

### TC08: コンボシステムの確認

**目的**: 連続してズボンを上げた場合にコンボボーナスが発生することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 連続して3回ズボンを上げる
4. `combo-display` が「3」になることを確認
5. 3回目のスコアにコンボボーナス（15点）が追加されることを確認

---

### TC09: ゲームオーバー条件

**目的**: ライフが0になった場合にゲームオーバーになることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 意図的に3回ズボンを落とす（ライフを0にする）
4. `status-message` が「ゲームオーバー」になることを確認
5. `retry-button` が表示されることを確認
6. ズボン落下イベントが停止することを確認

---

### TC10: リトライ機能

**目的**: ゲームオーバー時のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームをプレイしてゲームオーバーにする
3. `retry-button` をクリック
4. `score-display` が「0」にリセットされることを確認
5. `life-display` が「3」にリセットされることを確認
6. `combo-display` が「0」にリセットされることを確認
7. `status-message` が「ゲーム中」になることを確認
8. 新しいズボン落下イベントが開始されることを確認

---

### TC11: 難易度調整の確認

**目的**: 時間経過とともに難易度が上がることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 30秒間ゲームを継続
4. ズボン落下の間隔が短くなることを確認
5. ズボンの落下速度が速くなることを確認（可能であれば）

---

### TC12: 連続クリック防止

**目的**: ズボン落下イベント中でない時のクリックが無効化されていることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ズボンが落ちていない通常状態で `character-area` をクリック
4. スコアが変化しないことを確認
5. ゲーム状態に影響しないことを確認

---

### TC13: モバイル対応確認

**目的**: モバイル画面サイズでレイアウトが正常に表示されることを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が画面内に収まって表示されることを確認
4. `character-area` が適切なサイズでタッチしやすいことを確認
5. ゲームが正常にプレイできることを確認

---

### TC14: スコア計算の正確性

**目的**: 複数のスコアパターンでの計算が正確に行われることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 以下のパターンでスコアを獲得:
   - パーフェクト (20点)
   - グッド (10点) 
   - 早すぎ (5点)
   - コンボボーナス付き
4. 各ケースでスコアが正確に計算されることを確認

---

### TC15: 長時間プレイでの安定性

**目的**: 長時間プレイしても正常に動作することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 2分間継続してプレイ
4. メモリリークやパフォーマンス低下がないことを確認
5. ズボン落下イベントが正常に継続することを確認

---

## 🔧 テストのための補足実装（推奨）

- ズボンの落下状態をdata属性で確認可能にすること
- テスト用のフラグ（例: ?test=true）でズボンの落下速度を調整可能にすること
- 現在のゲーム状態をDOMで確認可能にすること（フェーズ情報など）
- コンボ数やライフ数をdata属性で取得可能にすること

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、ズボン落下のタイミングを適切に制御すること
- ズボン落下中の状態変化を正確に検証するため、適切な待機時間を設定すること
- 連続したズボン上げのテストでは、各フェーズ間の状態遷移を慎重に検証すること
- タイミング判定のテストでは、クリックのタイミングを精密に制御すること