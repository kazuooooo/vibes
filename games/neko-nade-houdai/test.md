# ネコ撫で放題 – Playwright E2E テストケース

## 概要

本ドキュメントは、Webカジュアルゲーム「ネコ撫で放題」のE2Eテストケース一覧です。Playwrightを用いて、UIの描画、ユーザーインタラクション、ネコ出現システム、スコア計算、時間管理などの一貫性と正確性を検証します。

---

## 📘 前提条件

- アプリは `/` ルートで起動
- ページ読み込み時にゲームが初期状態で表示される
- 以下のセレクターが利用可能であること（data-testid）

| テストID | 対象UI |
|----------|--------|
| `title` | ゲームタイトル表示 |
| `start-button` | スタートボタン |
| `retry-button` | リトライボタン |
| `game-area` | ネコ表示ゲームエリア |
| `score-display` | スコア表示 |
| `time-display` | 残り時間表示 |
| `combo-display` | 連続撫で数表示 |
| `status-message` | 状態メッセージ表示 |
| `cat` | ネコ要素（動的生成、複数存在） |
| `final-score` | 最終スコア表示（ゲーム終了時） |

---

## 🧪 テストケース一覧

### TC01: 初期表示の確認

**目的**: ページ初期ロード時にUI要素が正しく表示されるか確認

**手順**
1. `/` にアクセス
2. `title`, `start-button`, `score-display`, `time-display` が存在することを確認
3. `start-button` が有効であることを確認
4. `game-area` が存在することを確認
5. 初期スコアが「0」、初期時間が「60」であることを確認
6. `combo-display` が「0」であることを確認

---

### TC02: ゲーム開始でタイマーが作動

**目的**: スタートボタンでゲームが開始し、時間カウントダウンが始まることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. `status-message` が「プレイ中」になることを確認
4. `time-display` が「60」から「59」に変わることを確認（1秒待機後）
5. `start-button` が無効化されることを確認

---

### TC03: ネコが出現する

**目的**: ゲーム開始後に定期的にネコが出現することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 2秒以内に `cat` 要素が1つ以上出現することを確認
4. ネコがゲームエリア内に表示されることを確認
5. ネコが3秒以内に自動的に消えることを確認（クリックしない場合）

---

### TC04: ネコをクリックしてスコア獲得

**目的**: ネコをクリックした時にスコアが増加し、ネコが消えることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 出現した `cat` 要素をクリック
4. `score-display` が「10」になることを確認
5. クリックしたネコが消えることを確認
6. 撫でアニメーション（拡大・回転・ハート）が表示されることを確認

---

### TC05: 連続ボーナスシステム

**目的**: 連続してネコを撫でた時にボーナス得点が加算されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 5匹のネコを連続でクリック
4. 5匹目のクリック後、`score-display` が「75」（10×5 + 5×5ボーナス）になることを確認
5. `combo-display` が「5」になることを確認

---

### TC06: 空クリックでコンボリセット

**目的**: ネコ以外の場所をクリックした時に連続ボーナスがリセットされることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 3匹のネコを連続でクリック
4. `combo-display` が「3」になることを確認
5. ネコがない場所をクリック
6. `combo-display` が「0」にリセットされることを確認

---

### TC07: 時間経過によるネコ出現頻度の変化

**目的**: ゲーム進行に応じてネコの出現頻度が上がることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 最初の20秒間のネコ出現間隔を記録
4. 20-40秒の時間帯でのネコ出現間隔を記録
5. 40-60秒の時間帯でのネコ出現間隔を記録
6. 時間経過とともに出現間隔が短くなることを確認

---

### TC08: 制限時間終了時の処理

**目的**: 制限時間が0になった時にゲームが正常に終了することを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 60秒待機（または高速化設定で短縮）
4. `time-display` が「0」になることを確認
5. `status-message` が「終了」になることを確認
6. `final-score` が表示されることを確認
7. `retry-button` が表示されることを確認
8. 新しいネコが出現しなくなることを確認

---

### TC09: リトライ機能

**目的**: ゲーム終了後のリトライ機能が正常に動作することを確認

**手順**
1. `/` にアクセス
2. ゲームを完了して終了状態にする
3. `retry-button` をクリック
4. `score-display` が「0」にリセットされることを確認
5. `time-display` が「60」にリセットされることを確認
6. `combo-display` が「0」にリセットされることを確認
7. `status-message` が「準備中」になることを確認
8. `start-button` が再度有効になることを確認

---

### TC10: 複数ネコ同時出現の処理

**目的**: 複数のネコが同時に画面に表示された時の処理が正常であることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 複数の `cat` 要素が同時に存在することを確認（最大3匹）
4. 異なるネコを順番にクリック
5. それぞれのネコが正しく処理され、スコアが適切に加算されることを確認
6. クリックしていないネコは時間経過で消えることを確認

---

### TC11: ネコ表示位置の重複回避

**目的**: ネコが同じ位置に重複して表示されないことを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 複数のネコが出現した際に、位置が重複していないことを確認
4. 各ネコの座標が適切に分離されていることを確認

---

### TC12: モバイル対応確認

**目的**: モバイル画面サイズでレイアウトと操作が正常であることを確認

**手順**
1. ビューポートを iPhone SE サイズ (375x667) に設定
2. `/` にアクセス
3. すべてのUI要素が画面内に収まって表示されることを確認
4. ネコが適切なサイズでタッチしやすいことを確認（最小80px）
5. ゲームが正常にプレイできることを確認
6. スコア・時間表示が適切に配置されることを確認

---

### TC13: 高得点時のボーナス計算

**目的**: 高連続数達成時のボーナス計算が正確に行われることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 15匹のネコを連続でクリック
4. スコア計算が正確であることを確認:
   - 基本得点: 10×15 = 150点
   - 5匹ボーナス: 5×3回 = 15点
   - 10匹ボーナス: 10×1回 = 10点  
   - 15匹ボーナス: 15×1回 = 15点
   - 合計: 190点
5. `score-display` が「190」になることを確認

---

### TC14: ネコの消失タイミング

**目的**: ネコの自動消失タイミングが正確であることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. 出現したネコをクリックせずに待機
4. 3秒後にネコが自動的に消えることを確認
5. 消失時にフェードアウトアニメーションが表示されることを確認

---

### TC15: 連続クリック防止

**目的**: 同一箇所での連続クリックが適切に処理されることを確認

**手順**
1. `/` にアクセス
2. `start-button` をクリック
3. ネコが出現したらその場所を素早く複数回クリック
4. 1匹分のスコアのみが加算されることを確認
5. 重複処理が発生しないことを確認

---

## 🔧 テストのための補足実装（推奨）

- ネコ要素に `data-testid="cat"` と `data-cat-id` で個別識別を追加
- テスト用のクエリパラメータ（例: ?test=true）でネコの出現間隔を短縮可能に
- 現在の連続数とスコア詳細をdata属性で確認可能に
- ゲーム状態をDOMで確認可能に（current-phase等）

---

## 📄 備考

- テストはPlaywrightの `page.waitForSelector` や `page.waitForTimeout` を活用して、ネコ出現のタイミングを適切に制御すること
- ネコの出現・消失アニメーションを考慮した適切な待機時間を設定すること
- 時間依存のテストでは、ゲーム時間の短縮モードを利用することを推奨
- 連続ボーナス計算の複雑なケースでは、段階的な検証を行うこと